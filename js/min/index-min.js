function init(e){$.each(frequencyData,function(e){$.each(frequencyData,function(n){var t=.5*-e,a=.5*n+.5;group.add(0===frequencyData[n]?cube(a,.01,t):cube(a,frequencyData[n],t))}),scene.add(group)})}function anim(){if(group.children.length>0){var e=0;$.each(group.children,function(n){e<frequencyData.length-1?e++:e=0,this.position.z>5?this.position.z=-10.5:this.position.z+=.1,this.scale.y=.2*frequencyData[e]})}controls.update()}function cube(e,n,t){var a=new THREE.BoxGeometry(.4,.4,.4),r=new THREE.MeshPhongMaterial,o=new THREE.Mesh(a,r);return o.castShadow=!0,o.receiveShadow=!0,o.position.x=e,o.position.z=t,o.scale.y=n,o}function color(){var e="rgb("+(Math.floor(255*Math.random())-150)+","+(Math.floor(255*Math.random())-150)+","+(Math.floor(255*Math.random())-150)+")";return e+""}function render(){return stats.begin(),$loop=requestAnimationFrame(render),stats.end(),anim(),renderer.render(scene,camera),$loop}var context;"undefined"!=typeof AudioContext?context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(context=new webkitAudioContext);for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var t=(new Date).getTime(),a=Math.max(0,16-(t-lastTime)),r=window.setTimeout(function(){e(t+a)},a);return lastTime=t+a,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e),$time=0});var analyser=context.createAnalyser();analyser.fftSize=64;for(var frequencyData=new Uint8Array(analyser.frequencyBinCount),barSpacingPercent=100/analyser.frequencyBinCount,$array=[],i=0;i<analyser.frequencyBinCount;i++)$array.push(i*barSpacingPercent);var $audioData=[],$loop,stats=new Stats;stats.setMode(0),stats.domElement.style.position="absolute",stats.domElement.style.right="0px",stats.domElement.style.top="0px",document.body.appendChild(stats.domElement);var scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,.5,1e3);camera.position.y=1,camera.position.z=5.5;var renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(13421772,0),renderer.shadowMapType=THREE.PCFSoftShadowMap,renderer.shadowMapEnabled=!0,renderer.shadowMapSoft=!0,renderer.shadowCameraFov=150,renderer.shadowMapBias=.1,renderer.shadowMapDarkness=.5;var controls=new THREE.OrbitControls(camera);controls.rotateSpeed=.1,controls.keyPanSpeed=.001;var plane_geometry=new THREE.PlaneGeometry(window.innerWidth,window.innerHeight,32),plane_material=new THREE.MeshLambertMaterial({color:13421772,side:THREE.DoubleSide}),plane=new THREE.Mesh(plane_geometry,plane_material);plane.rotation.x=-Math.PI/2,plane.receiveShadow=!0,scene.add(plane);var spotLight=new THREE.SpotLight(16777215,1);spotLight.position.set(5,3,10),scene.add(spotLight);var ambientLight=new THREE.AmbientLight(11184810);scene.add(ambientLight),document.body.appendChild(renderer.domElement);var group,currCount=0,$max=10,onScreen=[],$duration=$("#player").get(0).duration,$timeLineWidth=$("#audioNav").width()-100,source=context.createMediaElementSource($("#player").get(0));source.connect(analyser),analyser.connect(context.destination),$("#player").on({canplay:function(){},timeupdate:function(e){analyser.getByteFrequencyData(frequencyData);var n=Math.round(100*$(this).get(0).currentTime/$timeLineWidth),t=.01*n*$timeLineWidth;$(".time").css({width:n})},play:function(){$loop=render(),init(),$("#player").get(0).muted=!0},pause:function(){$(".output").empty(),cancelAnimationFrame($loop)}}),$("#audioNav").bind({click:function(e){var n=Math.round(100*(e.clientX-100)/$timeLineWidth),t=.01*n*$timeLineWidth;$(".time").css("width",t),$("#player").get(0).currentTime=$duration*n/100}}),$("#audioNav .play").bind({click:function(){$("#player").get(0).paused?($(this).removeClass("off").addClass("on"),$("#player").get(0).play()):($(this).removeClass("on").addClass("off"),$("#player").get(0).pause(),$(".output").empty(),cancelAnimationFrame($loop))}}),$("#audioNav .pause").bind({click:function(){$("#player").get(0).pause()}});var group=new THREE.Object3D,$groups=[],oldData,$data=[];camera.lookAt(new THREE.Vector3(0,0,0));